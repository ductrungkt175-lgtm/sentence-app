<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ch·ªçn c√¢u h·ªçc</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #000;
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: #fff;
            margin-bottom: 20px;
            font-size: 2rem;
        }

        .back-button {
            background-color: #666;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin-bottom: 20px;
        }

        .back-button:hover {
            background-color: #555;
        }

        .selected-count {
            text-align: center;
            color: #ccc;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }

        .sentences-list {
            margin-bottom: 30px;
        }

        .sentence-item {
            background-color: #222;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sentence-item:hover {
            background-color: #2a2a2a;
            border-color: #444;
        }

        .sentence-content {
            flex: 1;
        }

        .sentence-en {
            font-size: 1.2rem;
            color: #1a73e8;
            margin-bottom: 5px;
        }

        .sentence-info {
            display: flex;
            gap: 15px;
            color: #888;
            font-size: 0.9rem;
        }

        .sentence-level {
            color: #4caf50;
        }

        .sentence-audio-indicator {
            color: #fff;
            font-size: 1.5rem;
            padding: 5px 10px;
            border-radius: 5px;
        }

        .actions {
            text-align: center;
            margin-top: 30px;
        }

        .typing-button {
            background-color: #2196f3;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background 0.3s;
        }

        .typing-button:hover {
            background-color: #1976d2;
        }

        .typing-button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }

        .no-sentences {
            text-align: center;
            color: #666;
            padding: 40px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Danh s√°ch c√¢u h·ªçc</h1>
            <a href="index.html" class="back-button">‚Üê Quay l·∫°i</a>
        </header>

        <div class="selected-count">
            ƒê√£ t·ª± ƒë·ªông ch·ªçn <span id="count">5</span> c√¢u ∆∞u ti√™n nh·∫•t
        </div>

        <div class="sentences-list" id="sentencesList">
            <!-- Danh s√°ch c√¢u s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y -->
        </div>

        <div class="actions">
            <button class="typing-button" id="typingButton">B·∫Øt ƒë·∫ßu Typing</button>
        </div>
    </div>

    <script>
        let selectedSentences = [];

        // L·∫•y danh s√°ch c√¢u ∆∞u ti√™n
        function getPrioritySentences(vocabularies) {
            const now = Date.now();
            const sentencesByLevel = {};
            
            // L·ªçc c√¢u ƒë√£ t·ªõi h·∫°n v√† ph√¢n lo·∫°i level
            for (const v of vocabularies) {
                if (v.nt && v.nt > now) continue;
                
                const level = v.l || 0;
                if (!sentencesByLevel[level]) sentencesByLevel[level] = [];
                
                const hoursOverdue = v.nt ? Math.floor((now - v.nt) / 3600000) : 0;
                sentencesByLevel[level].push({
                    ...v,
                    hoursOverdue: hoursOverdue > 0 ? hoursOverdue : 0
                });
            }
            
            // S·∫Øp x·∫øp ∆∞u ti√™n: level 1 ‚Üí 2 ‚Üí 3 ‚Üí ... ‚Üí 0
            const priorityOrder = [];
            const levelOrder = [1, 2, 3, 4, 5, 6, 7, 8, 9, 0];
            
            for (const level of levelOrder) {
                if (sentencesByLevel[level]) {
                    sentencesByLevel[level].sort((a, b) => b.hoursOverdue - a.hoursOverdue);
                    priorityOrder.push(...sentencesByLevel[level]);
                }
            }
            
            return priorityOrder;
        }

        // Ph√°t √¢m thanh c√¢u
        function speakSentence(sentence) {
            if (!('speechSynthesis' in window)) return;
            
            const utterance = new SpeechSynthesisUtterance(sentence);
            utterance.lang = 'en-US';
            utterance.rate = parseFloat(localStorage.getItem('speechRate') || '1.0');
            
            window.speechSynthesis.cancel();
            window.speechSynthesis.speak(utterance);
        }

        // Hi·ªÉn th·ªã danh s√°ch c√¢u
        function displaySentences() {
            const sentencesList = document.getElementById('sentencesList');

            if (selectedSentences.length === 0) {
                sentencesList.innerHTML = '<div class="no-sentences">Kh√¥ng c√≥ c√¢u n√†o ƒë·ªÉ h·ªçc</div>';
                document.getElementById('typingButton').disabled = true;
                return;
            }

            sentencesList.innerHTML = selectedSentences.map((sentence, index) => {
                return `
                    <div class="sentence-item" 
                         onclick="speakSentence('${(sentence.en || sentence.w).replace(/'/g, "\\'")}')">
                        <div class="sentence-content">
                            <div class="sentence-en">${sentence.en || sentence.w}</div>
                            <div class="sentence-info">
                                <span class="sentence-level">Lv${sentence.l || 0}</span>
                                <span>${sentence.vn || sentence.m}</span>
                            </div>
                        </div>
                        <div class="sentence-audio-indicator">
                            üîä
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Chuy·ªÉn ƒë·∫øn trang typing
        function goToTyping() {
            if (selectedSentences.length === 0) return;
            
            const encodedSentences = encodeURIComponent(JSON.stringify(selectedSentences));
            window.location.href = `type.html?sentences=${encodedSentences}`;
        }

        // Kh·ªüi t·∫°o
        function init() {
            const vocabularies = JSON.parse(localStorage.getItem('vocabularies') || '[]');
            const prioritySentences = getPrioritySentences(vocabularies);
            
            // T·ª± ƒë·ªông ch·ªçn 5 c√¢u ƒë·∫ßu ti√™n
            selectedSentences = prioritySentences.slice(0, 5);
            
            displaySentences();

            // G·∫Øn s·ª± ki·ªán
            document.getElementById('typingButton').addEventListener('click', goToTyping);
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>